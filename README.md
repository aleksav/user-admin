user-admin
-------
Generated by TSF.tech

The project is designed to run entirely within Docker.
It is seperated into a components each runs in their own container.
Docker-compose is used to define how these containers are configure and connected.
The composition is seperated into 3 layers, each defined in a seperate docker-compose.yml file
1. docker-compose.yml contains the production deployment configuration (or a replica of, if you choose not to deploy in Docker)
1. docker-compose.test.yml extends the production config overwriting parameters and adding additional test components
1. docker-compose.dev.yml extend the production config to provide dev firendly additions, mount code and configure auto reloading etc
You may run in either configuration, respectively using
```
COMPOSE_FILE=docker-compose.yml docker-compose up
COMPOSE_FILE=docker-compose.yml:docker-compose.test.yml docker-compose up
COMPOSE_FILE=docker-compose.yml:docker-compose.test.yml:docker-compose.dev.yml docker-compose up
```

The components are:
1. web - the client side app served to and executed in a users browser
1. server - the backend
1. db - the long term data storage
1. load_test - a test component that fires many requests at the server to see how well it copes

Each can be ran individually by specifying the component, for example
```
COMPOSE_FILE=docker-compose.yml:docker-compose.test.yml docker-compose up load_test
```

## Travis CI

Generator automatically generates .travis.yml for github/travis integration.
To successfuly deploy your app on develop branch build, you need to add relevant encrypted environment variables for heroku and S3 deployment

### Generating encrypted env variables for Travis

Prerequisites: 
* travis cli installed

Command: ```travis encrypt ENV_VAR_NAME=env-var_value```

* Deploying server to Heroku

Upon generation, add the heroku auth API key to the config placeholder.
Ensure heroku cli is installed and configured

To get the encrypted auth API key, run:

```travis encrypt HEROKU_AUTH_KEY=$(heroku auth:token)```

Add the config to the project spec.

* Deploying web to S3

Ensure relevant S3 buckets are created (see infra directory)

Set AWS credentials env variables:

```travis encrypt AWS_ACCESS_KEY_ID=your_aws_key```

```travis encrypt AWS_SECRET_ACCESS_KEY=your_aws_secret```

Add the config to the project spec.

## Promoting release from dev to demo environment

Promotion script performs the following actions:

* Take the server docker image from dev environment and push it to demo env as is

* Rebuild front end locally, and push it to demo S3 bucket. This is due to the API base URL being injected into front end at build time, so front end needs to be rebuilt for each environment individually

#### Prerequisites

* Ensure the machine from where you run the promotion script has aws-cli installed :

```https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html```

```https://docs.aws.amazon.com/cli/latest/userguide/install-macos.html```

* Ensure you have aws-cli configured (AWS credentials that have access to the S3 buckets, either by setting env variables or  ~/.aws/credentials file

```https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html```

* Ensure you have heroku cli installed and configure: 

```https://devcenter.heroku.com/articles/heroku-cli```

* Ensure you have latest generated code on the machine from where the script runs. This is so that front-end code can be built locally before being pushed (as per the note above)

#### Running the promotion script:

```scripts/promote-dev-to-demo.sh```